{% load static %}
<!DOCTYPE html>
<html
  lang="en"
  class="light-style layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="{% static 'assets' %}"
  data-template="vertical-menu-template-free"
>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <title>SafeNet : Data Explorer</title>

    <meta name="description" content="" />

      <!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap Bundle with Popper.js (required for dropdowns) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'assets/img/favicon/favicon.png' %}" />

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="{% static 'assets/vendor/fonts/boxicons.css' %}" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="{% static 'assets/vendor/css/core.css' %}" class="template-customizer-core-css" />
    <link rel="stylesheet" href="{% static 'assets/vendor/css/theme-default.css' %}" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="{% static 'assets/css/demo.css' %}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="{% static 'assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/vendor/libs/apex-charts/apex-charts.css' %}" />

    <!-- Page CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">

    <!-- Helpers -->
    <script src="{% static 'assets/vendor/js/helpers.js' %}"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="{% static 'assets/js/config.js' %}"></script>
      <style>
.avatar-online::before {
    content: '';
    position: absolute;
    bottom: 0;
    right: 3px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    border: 2px solid #fff;
    background-color: #71dd37;
}

.avatar {
    position: relative;
    display: inline-block;
}

.avatar img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}


        .table-responsive {
    overflow-x: hidden; /* Prevents horizontal scrolling */
}

.table thead th {
    white-space: nowrap; /* Prevents header cells from wrapping */
    overflow: hidden; /* Hides overflow */
    text-overflow: ellipsis; /* Adds ellipsis for overflow text */
}
.card {
    box-shadow: 0 2px 6px 0 rgba(67, 89, 113, 0.12);
    border: none;
}

.btn-icon {
    width: 32px;
    height: 32px;
    padding: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}



.table th {
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
    white-space: nowrap;
}

.table td {
    vertical-align: middle;
}

.input-group {
    border-radius: 0.375rem;
    overflow: hidden;
}

.toast {
    opacity: 0.9;
    transition: opacity 0.3s ease;
}

.toast:hover {
    opacity: 1;
}

.badge {
    padding: 0.5em 0.75em;
    font-weight: 500;
}

.bg-label-primary {
    background-color: #e7e7ff;
    color: #696cff;
}

.bg-label-success {
    background-color: #e8fadf;
    color: #71dd37;
}

.table-responsive {
    margin: 0 -1.5rem;
    padding: 0 1.5rem;
    border-top: 1px solid #e7e7e8;
}

.dataTables_wrapper .row {
    margin: 1rem 0;
    align-items: center;
}

.dataTables_filter input {
    border: 1px solid #e7e7e8;
    border-radius: 0.375rem;
    padding: 0.375rem 0.75rem;
    margin-left: 0.5rem;
}

.dataTables_length select {
    border: 1px solid #e7e7e8;
    border-radius: 0.375rem;
    padding: 0.375rem 2rem 0.375rem 0.75rem;
    margin: 0 0.5rem;
}
    <!-- Custom Scrollbar Styles -->
      .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
      }

      .custom-scrollbar::-webkit-scrollbar-thumb {
          background-color: #4B5563;
          border-radius: 5px;
      }

      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background-color: #2D3748;
      }

      .custom-scrollbar::-webkit-scrollbar-track {
          background-color: #F7FAFC;
      }
    /* Custom scrollbar styles for Risky User Management */
    .risky-users-container {
        max-height: 400px; /* Height of approximately 4 rows plus header */
        overflow-y: auto;
        overflow-x: hidden;
        scrollbar-width: thin;
        scrollbar-color: #4B5563 #F3F4F6;
    }

    .risky-users-container::-webkit-scrollbar {
        width: 6px;
    }

    .risky-users-container::-webkit-scrollbar-track {
        background: #F3F4F6;
        border-radius: 8px;
    }

    .risky-users-container::-webkit-scrollbar-thumb {
        background-color: #4B5563;
        border-radius: 8px;
        border: 2px solid transparent;
        background-clip: padding-box;
    }

    .risky-users-container::-webkit-scrollbar-thumb:hover {
        background-color: #374151;
    }

    /* Sticky header for the table */
    .risky-users-table thead {
        position: sticky;
        top: 0;
        background: white;
        z-index: 1;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    /* Common scrollable container styles for all cards */
    .card-scrollable-container {
        max-height: 300px; /* Height for ~3 items */
        overflow-y: auto;
        overflow-x: hidden;
        scrollbar-width: thin;
        scrollbar-color: #4B5563 #F3F4F6;
    }

    .card-scrollable-container::-webkit-scrollbar {
        width: 6px;
    }

    .card-scrollable-container::-webkit-scrollbar-track {
        background: #F3F4F6;
        border-radius: 8px;
    }

    .card-scrollable-container::-webkit-scrollbar-thumb {
        background-color: #4B5563;
        border-radius: 8px;
        border: 2px solid transparent;
        background-clip: padding-box;
    }

    .card-scrollable-container::-webkit-scrollbar-thumb:hover {
        background-color: #374151;
    }
    /* Enhanced UI styles */
.card {
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.card-scrollable-container {
    scrollbar-width: thin;
    scrollbar-color: #CBD5E0 #EDF2F7;
}

.dismiss-activity-form button {
    opacity: 0.8;
    transition: all 0.2s ease;
}

.dismiss-activity-form button:hover {
    opacity: 1;
    transform: scale(1.05);
}

/* Loading animation */
.loading-skeleton {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    @apply bg-gray-200 rounded;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: .5;
    }
}
    </style>
  </head>
<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->
        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
          <div class="app-brand demo">
            <a href="#" class="app-brand-link">  <!-- Use your actual URL name -->
              <span class="app-brand-logo demo">
                <img src="{% static 'assets/img/logo/s.png' %}" alt="Logo" style="width: 50px; height: auto;" />
              </span>
              <span class="app-brand-text demo menu-text fw-bolder ms-2">SafeNet</span>
            </a>

            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
              <i class="bx bx-chevron-left bx-sm align-middle"></i>
            </a>
          </div>

          <div class="menu-inner-shadow"></div>

          <ul class="menu-inner py-1">
            <!-- Dashboard -->
            <li class="menu-item">
              <a href="{% url 'dashboard:dashboard' %}" class="menu-link"> <!-- Use your actual URL name -->
                <i class="menu-icon tf-icons bx bx-home-circle"></i>
                <div data-i18n="Analytics">Dashboard</div>
              </a>
            </li>
              

            <li class="menu-item">
              <a href="{% url 'notifications:notification_list' %}" class="menu-link">
                <i class="menu-icon tf-icons bx bx-bell"></i>
                <div data-i18n="Notifications">Notifications</div>
              </a>
            </li>

            <!-- Projects -->
            <li class="menu-header small text-uppercase"><span class="menu-header-text">Projects</span></li>

            <li class="menu-item ">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-briefcase"></i>
                <div data-i18n="Project Management">Project</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="{% url 'project_list' %}" class="menu-link"> <!-- Use your actual URL name -->
                    <div data-i18n="View Projects">View Projects</div>
                  </a>
                </li>
                <li class="menu-item active">
                  <a href="javascript:void(0);" class="menu-link"> <!-- Use your actual URL name -->
                    <div data-i18n="Create Project">Create Project</div>
                  </a>
                </li>
              </ul>
            </li>

            <!-- Tasks -->
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-check-square"></i>
                <div data-i18n="Project Management">Task</div>
              </a>

              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="{% url 'tasks:task_list' %}" class="menu-link"> <!-- Use your actual URL name -->
                    <div data-i18n="View Projects">View Tasks</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="{% url 'tasks:create_task' %}" class="menu-link"> <!-- Use your actual URL name -->
                    <div data-i18n="Create Project">Create Task</div>
                  </a>
                </li>
              </ul>
            </li>

            <!-- Data View -->
            <li class="menu-item">
              <a href="{% url 'data_explorer:data_explorer_home' %}" class="menu-link"> <!-- Use your actual URL name -->
                <i class="menu-icon tf-icons bx bx-table"></i>
                <div data-i18n="Data View">Data Explorer</div>
              </a>
            </li>

            <!-- Data Leakage Alert -->
            <li class="menu-header small text-uppercase"><span class="menu-header-text">Security</span></li>
            <li class="menu-item active">
              <a href="javascript:void(0);" class="menu-link"> <!-- Use your actual URL name -->
                <i class="menu-icon tf-icons bx bx-shield-quarter"></i>
                <div data-i18n="Data Leakage Alert">Data Leakage</div>
              </a>
            </li>
          </ul>
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->
          <nav
            class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
            id="layout-navbar"
          >
            <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
              <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                <i class="bx bx-menu bx-sm"></i>
              </a>
            </div>

            <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
              <!-- Search -->
              <div class="navbar-nav align-items-center">
                <div class="nav-item d-flex align-items-center">
                  <i class="bx bx-search fs-4 lh-0"></i>
                  <input
                    type="text"
                    class="form-control border-0 shadow-none"
                    placeholder="Search..."
                    aria-label="Search..."
                  />
                </div>
              </div>
              <!-- /Search -->

           <!-- User Profile Dropdown -->
          <ul class="navbar-nav flex-row align-items-center ms-auto">
            <li class="nav-item navbar-dropdown dropdown-user dropdown">
    <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
        <div class="avatar avatar-online">
            <img src="{% if request.user.profile.profile_picture %}{{ request.user.profile.profile_picture.url }}{% else %}{% static 'profile_pics/' %}{{ request.user.username }}{% endif %}"
                 alt="User Avatar"
                 class="w-px-40 h-px-40 rounded-circle"
                 style="object-fit: cover;" />
        </div>
    </a>
    <ul class="dropdown-menu dropdown-menu-end">
        <li>
            <a class="dropdown-item" href="#">
                <div class="d-flex">
                    <div class="flex-grow-1">
                        <span class="fw-semibold d-block">
                            {% if request.user.profile.first_name and request.user.profile.last_name %}
                                {{ request.user.profile.first_name }} {{ request.user.profile.last_name }}
                            {% else %}
                                {{ request.user.username }}
                            {% endif %}
                        </span>
                        <small class="text-muted">
                            {% if request.user.is_superuser %}
                                Admin
                            {% else %}
                                User
                            {% endif %}
                        </small>
                    </div>
                </div>
            </a>
        </li>
                <li><div class="dropdown-divider"></div></li>
                <li>
                  <a class="dropdown-item" href="{% url 'accounts:account_settings' %}">  <!-- Changed to match URL pattern name -->
                    <i class="bx bx-user me-2"></i>
                    <span class="align-middle">My Profile</span>
                  </a>
                </li>
                <li>
                  <form action="{% url 'accounts:logout' %}" method="POST" style="display:inline;">
                    {% csrf_token %}
                    <a class="dropdown-item" href="#" onclick="this.closest('form').submit(); return false;">
                      <i class="bx bx-power-off me-2"></i>
                      <span class="align-middle">Log Out</span>
                    </a>
                  </form>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
          <!-- / Navbar -->


<div class="content-wrapper">
    <div class="container-xxl flex-grow-1 container-p-y">
<body class="bg-gray-100">
    <div class="min-h-screen">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <h1 class="text-xl font-bold text-gray-800">Data Leakage Dashboard</h1>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto py-6 px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-6">
                <!-- Blocking History (Moved here to replace Sensitivity Scan) -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">Blocking History</h2>
                    <div class="card-scrollable-container space-y-4">
                        {% if blocking_history %}
                            {% for entry in blocking_history %}
                            <div class="border-b pb-4 flex flex-col space-y-2 hover:bg-gray-100 transition duration-200">
                                <div class="flex items-center space-x-2">
                                    <span class="text-{{ entry.severity }}-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5" viewBox="0 0 20 20"><path d="M10 4a1 1 0 011 1v6a1 1 0 11-2 0V5a1 1 0 011-1zm0 8a1 1 0 011 1v2a1 1 0 11-2 0v-2a1 1 0 011-1zM18 10a8 8 0 11-16 0 8 8 0 0116 0z"></path></svg>
                                    </span>
                                    <p class="text-xl font-semibold">{{ entry.user.username }} - {{ entry.action }}</p>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">{{ entry.timestamp }}</span>
                                    <span class="text-sm font-medium text-gray-500">{{ entry.details }}</span>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-gray-600">Nothing yet to show</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Anomalous User Activity -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">Anomalous User Activity</h2>
                    <div class="card-scrollable-container space-y-4">
                        {% if anomalous_users %}
                            {% for user in anomalous_users %}
                            <div class="border-l-4 {% if user.sensitivity_score >= 80 %}border-red-500{% else %}border-yellow-500{% endif %} pl-4">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-medium">{{ user.user.username }}</p>  <!-- Changed from email to username -->
                                        <p class="text-sm text-gray-600">Risk Score: {{ user.sensitivity_score }}</p>
                                    </div>
                                    {% if user.user.id %}  <!-- Add check for user ID -->
                                    <form method="POST" action="{% url 'accounts:toggle_user_block' user.user.id %}">
                                        {% csrf_token %}
                                        <button type="submit" 
                                                class="px-4 py-2 {% if not user.user.is_active %}bg-green-600 hover:bg-green-700{% else %}bg-red-600 hover:bg-red-700{% endif %} text-white rounded transition-all duration-300">
                                            {% if not user.user.is_active %}Unblock User{% else %}Block User{% endif %}
                                        </button>
                                    </form>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-gray-600">No anomalous activity detected</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Active Alerts -->
                <div class="bg-white rounded-lg shadow-lg p-6">
    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
        Active Alerts
    </h2>
    <div class="card-scrollable-container space-y-4">
        {% if user_activities %}
            {% for activity in user_activities %}
            <div class="bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
                <div class="p-4">
                    <!-- Activity Header -->
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 flex items-center justify-center rounded-full 
                                {% if 'uploaded' in activity.action %}bg-blue-100
                                {% elif 'deleted' in activity.action %}bg-red-100
                                {% elif 'logged' in activity.action %}bg-green-100
                                {% else %}bg-gray-100{% endif %}">
                                <i class="fas {% if 'uploaded' in activity.action %}fa-upload text-blue-500
                                    {% elif 'deleted' in activity.action %}fa-trash text-red-500
                                    {% elif 'logged in' in activity.action %}fa-sign-in-alt text-green-500
                                    {% elif 'logged out' in activity.action %}fa-sign-out-alt text-green-500
                                    {% else %}fa-exclamation-circle text-gray-500{% endif %} fa-lg"></i>
                            </div>
                            <div>
                                <span class="font-medium text-gray-900">{{ activity.action|title }}</span>
                                <p class="text-sm text-gray-500">{{ activity.timestamp|timesince }} ago</p>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Details -->
                    <div class="ml-13 pl-2 border-l-2 border-gray-200">
                        <div class="flex items-center space-x-2 mb-2">
                            <span class="text-sm text-gray-600">User:</span>
                            <span class="text-sm font-medium text-gray-900">{{ activity.user.username }}</span>
                            {% if activity.user.profile.sensitivity_score %}
                            <span class="px-2 py-1 text-xs font-medium rounded-full 
                                {% if activity.user.profile.sensitivity_score >= 80 %}bg-red-100 text-red-800
                                {% elif activity.user.profile.sensitivity_score >= 50 %}bg-yellow-100 text-yellow-800
                                {% else %}bg-green-100 text-green-800{% endif %}">
                                Score: {{ activity.user.profile.sensitivity_score }}
                            </span>
                            {% endif %}
                        </div>

                        <!-- Dismiss Button -->
                        <div class="flex justify-end mt-2">
    <form method="POST" action="{% url 'dataleakage:dismiss_activity' activity.id %}" 
          class="dismiss-activity-form">
        {% csrf_token %}
        <button type="submit" 
            class="inline-flex items-center px-3 py-1 text-xs font-medium text-gray-600 bg-gray-100 
                   hover:bg-gray-200 rounded transition-colors duration-200">
            Dismiss
        </button>
    </form>
</div>

                    </div>
                </div>
            </div>
            {% endfor %}
        {% endif %}
    </div>
</div>

                <!-- Risky User Management -->
                <div class="bg-white rounded-lg shadow p-6 col-span-3">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold text-gray-800">Risky User Management</h2>
                        <div class="flex space-x-2">
                            <select id="riskFilter" class="rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <option value="all">All Risks</option>
                                <option value="high">High Risk</option>
                                <option value="medium">Medium Risk</option>
                                <option value="low">Low Risk</option>
                            </select>
                        </div>
                    </div>
                    <div class="risky-users-container">
                        <table class="min-w-full divide-y divide-gray-200 risky-users-table">
                            <thead>
                                <tr>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Risk Level</th>
                                    <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {% for user in risky_users %}
                                <tr class="risk-row" data-risk="{{ user.risk_level|lower }}">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="ml-4">
                                                <div class="text-sm font-medium text-gray-900">{{ user.username }}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                                            {% if user.risk_level == 'High' %}bg-red-100 text-red-800
                                            {% elif user.risk_level == 'Medium' %}bg-yellow-100 text-yellow-800
                                            {% else %}bg-green-100 text-green-800{% endif %}">
                                            {{ user.risk_level }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                                            {% if user.is_blocked %}bg-red-100 text-red-800{% else %}bg-green-100 text-green-800{% endif %}">
                                            {{ user.status }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
    {% if user.id %}
    <form method="POST" action="{% url 'accounts:toggle_user_block' user.id %}" class="inline">
        {% csrf_token %}
        <button type="submit" 
                class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md 
                {% if user.status == 'Blocked' %}
                    bg-green-600 hover:bg-green-700
                {% else %}
                    bg-red-600 hover:bg-red-700
                {% endif %} 
                text-white focus:outline-none transition-all duration-300">
            {% if user.status == 'Blocked' %}
                <i class="fas fa-unlock mr-2"></i> Unblock
            {% else %}
                <i class="fas fa-lock mr-2"></i> Block
            {% endif %}
        </button>
    </form>
    {% endif %}
</td>

                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </main>
    </div>
</body>


        <!-- Footer -->
        <footer class="content-footer footer bg-footer-theme">
            <div class="container-xxl d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
                <div class="mb-2 mb-md-0">
                    ©
                    <script>
                        document.write(new Date().getFullYear());
                    </script>
                    , made with ❤️ by
                    <a href="https://vitap.ac.in/" target="_blank">VITians</a>
                </div>
            </div>
        </footer>
    </div>
    <!-- Content Backdrop -->
    <div class="content-backdrop fade"></div>
</div>
        </div>
<!-- / Layout page -->
</div>

<!-- Overlay -->
<div class="layout-overlay layout-menu-toggle"></div>
</div>
<!-- / Layout wrapper -->

<!-- Core JS -->
<!-- build:js assets/vendor/js/core.js -->
<script src="{% static 'assets/vendor/libs/jquery/jquery.js' %}"></script>
<script src="{% static 'assets/vendor/libs/popper/popper.js' %}"></script>
<script src="{% static 'assets/vendor/js/bootstrap.js' %}"></script>
<script src="{% static 'assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js' %}"></script>

<script src="{% static 'assets/vendor/js/menu.js' %}"></script>
<!-- endbuild -->

<!-- Vendors JS -->
<script src="{% static 'assets/vendor/libs/apex-charts/apexcharts.js' %}"></script>

<!-- Main JS -->
<script src="{% static 'assets/js/main.js' %}"></script>

<!-- Page JS -->
<script src="{% static 'assets/js/dashboards-analytics.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<!-- JavaScript for Charts and Tooltips -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="{% static 'assets/vendor/libs/jquery/jquery.js' %}"></script>
<script src="{% static 'assets/vendor/libs/popper/popper.js' %}"></script>
<script src="{% static 'assets/vendor/js/bootstrap.js' %}"></script>
<script src="{% static 'assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js' %}"></script>

<script src="{% static 'assets/vendor/js/menu.js' %}"></script>
<!-- endbuild -->

<!-- Vendors JS -->

<!-- Main JS -->
<script src="{% static 'assets/js/main.js' %}"></script>

<!-- Page JS -->

<!-- Place this tag in your head or just before your close body tag. -->
<script async defer src="https://buttons.github.io/buttons.js"></script>
<script>
document.getElementById('riskFilter').addEventListener('change', function() {
    const selectedRisk = this.value;
    const rows = document.querySelectorAll('.risk-row');
    
    rows.forEach(row => {
        if (selectedRisk === 'all' || row.dataset.risk === selectedRisk) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});

// Add toast notifications for actions
function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} transition-all duration-300 transform translate-y-0 opacity-100`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.add('opacity-0', 'translate-y-[-1rem]');
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// Handle form submissions with fetch
document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
            const response = await fetch(form.action, {
                method: 'POST',
                body: new FormData(form),
                headers: {
                    'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
                }
            });
            const data = await response.json();
            showToast(data.message, data.status);
            if (data.status === 'success') {
                setTimeout(() => location.reload(), 1000);
            }
        } catch (error) {
            showToast('An error occurred', 'error');
        }
    });
});

// Simplified dismiss activity handler without toast notifications
document.querySelectorAll('.dismiss-activity-form').forEach(form => {
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const activityCard = form.closest('.bg-white.border');
        const submitButton = form.querySelector('button');
        
        submitButton.disabled = true;
        
        try {
            const response = await fetch(form.action, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value,
                    'Content-Type': 'application/json'
                },
            });
            
            if (response.ok) {
                activityCard.style.opacity = '0';
                setTimeout(() => {
                    activityCard.remove();
                }, 200);
            }
        } catch (error) {
            console.error('Error:', error);
            submitButton.disabled = false;
        }
    });
});

// ...existing code...
</script>
</body>
</html>